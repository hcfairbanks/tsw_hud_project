<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Preset - TSW HUD Project</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #1a1a2e; color: #eee; }
        h1 { color: #00d4ff; text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #888; margin-bottom: 30px; }
        .nav { text-align: center; margin-bottom: 20px; }
        .nav a { color: #00d4ff; text-decoration: none; margin: 0 10px; padding: 10px 20px; background: #0f3460; border-radius: 4px; display: inline-block; }
        .nav a:hover { background: #1a4a7a; }
        .card { background: #16213e; border-radius: 8px; padding: 20px; margin-bottom: 20px; border: 1px solid #0f3460; }
        h2 { color: #00d4ff; margin-top: 0; border-bottom: 1px solid #0f3460; padding-bottom: 10px; }
        button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; margin-right: 5px; }
        .btn-primary { background: #00d4ff; color: #1a1a2e; }
        .btn-primary:hover { background: #00b8e6; }
        .btn-danger { background: #e94560; color: #fff; }
        .btn-danger:hover { background: #d63850; }
        .btn-secondary { background: #0f3460; color: #eee; }
        .btn-secondary:hover { background: #1a4a7a; }
        a { color: #00d4ff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .detail-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #0f3460; }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { color: #aaa; }
        .detail-value { color: #00d4ff; font-weight: bold; }
        .actions { margin-top: 20px; padding-top: 20px; border-top: 1px solid #0f3460; }
    </style>
</head>
<body>
    <h1 id="presetName">Weather Preset</h1>
    <p class="subtitle">Train Sim World Dashboard &amp; HUD System</p>
    <nav class="nav">
        <a href="/">Home</a>
        <a href="/weather">Weather Control</a>
        <a href="/weather-presets">All Presets</a>
    </nav>

    <div class="card">
        <h2>Preset Details</h2>
        <div id="presetDetails">
            <p style="text-align: center; color: #666;">Loading preset...</p>
        </div>
        <div class="actions">
            <button class="btn-primary" onclick="applyPreset()">Apply to Game</button>
            <button class="btn-danger" onclick="deletePreset()">Delete Preset</button>
        </div>
    </div>

    <script>
        const presetId = window.location.pathname.split('/').pop();
        let currentPreset = null;

        async function loadPreset() {
            try {
                const response = await fetch(`/api/weather-presets/${presetId}`);
                if (!response.ok) {
                    document.getElementById('presetDetails').innerHTML = '<p style="text-align: center; color: #e94560;">Preset not found</p>';
                    return;
                }

                currentPreset = await response.json();
                document.getElementById('presetName').textContent = currentPreset.name;
                document.title = `${currentPreset.name} - TSW HUD Project`;

                const html = `
                    <div class="detail-row">
                        <span class="detail-label">Temperature</span>
                        <span class="detail-value">${currentPreset.temperature}C</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Cloudiness</span>
                        <span class="detail-value">${(currentPreset.cloudiness * 100).toFixed(0)}%</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Precipitation</span>
                        <span class="detail-value">${(currentPreset.precipitation * 100).toFixed(0)}%</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Wetness</span>
                        <span class="detail-value">${(currentPreset.wetness * 100).toFixed(0)}%</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ground Snow</span>
                        <span class="detail-value">${(currentPreset.ground_snow * 100).toFixed(0)}%</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Piled Snow</span>
                        <span class="detail-value">${(currentPreset.piled_snow * 100).toFixed(0)}%</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Fog Density</span>
                        <span class="detail-value">${(currentPreset.fog_density * 100).toFixed(0)}%</span>
                    </div>
                `;
                document.getElementById('presetDetails').innerHTML = html;
            } catch (err) {
                document.getElementById('presetDetails').innerHTML = '<p style="text-align: center; color: #e94560;">Error loading preset</p>';
            }
        }

        async function applyPreset() {
            if (!currentPreset) return;

            const values = [
                { key: 'Temperature', value: currentPreset.temperature },
                { key: 'Cloudiness', value: currentPreset.cloudiness },
                { key: 'Precipitation', value: currentPreset.precipitation },
                { key: 'Wetness', value: currentPreset.wetness },
                { key: 'GroundSnow', value: currentPreset.ground_snow },
                { key: 'PiledSnow', value: currentPreset.piled_snow },
                { key: 'FogDensity', value: currentPreset.fog_density }
            ];

            let successCount = 0;
            for (const { key, value } of values) {
                try {
                    const response = await fetch(`/api/weather/set?key=${key}&value=${encodeURIComponent(value)}`, {
                        method: 'PATCH'
                    });
                    if (response.ok) successCount++;
                } catch (err) {
                    console.error(`Failed to set ${key}:`, err);
                }
            }

            if (successCount === values.length) {
                alert('Preset applied successfully!');
            } else {
                alert(`Partially applied (${successCount}/${values.length} values)`);
            }
        }

        async function deletePreset() {
            if (!confirm('Are you sure you want to delete this preset?')) return;

            try {
                const response = await fetch(`/api/weather-presets/${presetId}`, { method: 'DELETE' });
                if (response.ok) {
                    window.location.href = '/weather-presets';
                } else {
                    alert('Error deleting preset');
                }
            } catch (err) {
                alert('Error deleting preset');
            }
        }

        loadPreset();
    </script>
</body>
</html>

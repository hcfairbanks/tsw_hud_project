<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSW Raw Data</title>
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css">
    <script src="/js/theme-loader.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }
        h1 {
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 30px;
        }
        /* Nav styles now in theme.css */
        .status {
            text-align: center;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .status.connected {
            background: #1b4332;
            color: #95d5b2;
        }
        .status.disconnected {
            background: #4a1515;
            color: #f5a5a5;
        }
        .json-display {
            background: #0d1b2a;
            border: 1px solid #0f3460;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-all;
            max-width: 1200px;
            margin: 0 auto;
            color: #8be9fd;
        }
        .json-key {
            color: #ff79c6;
        }
        .json-string {
            color: #f1fa8c;
        }
        .json-number {
            color: #bd93f9;
        }
        .json-boolean {
            color: #ffb86c;
        }
        .json-null {
            color: #6272a4;
        }
    </style>
</head>
<body data-theme="dark">
    <h1>Raw JSON Data</h1>

    <nav id="main-nav"></nav>

    <div id="status" class="status disconnected">Connecting...</div>

    <div class="json-display" id="jsonDisplay">Waiting for data...</div>

    <script>
        const eventSource = new EventSource('/stream');
        const statusEl = document.getElementById('status');

        function syntaxHighlight(json) {
            if (typeof json !== 'string') {
                json = JSON.stringify(json, null, 2);
            }
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        eventSource.onopen = function() {
            statusEl.textContent = 'Connected';
            statusEl.className = 'status connected';
        };

        eventSource.onmessage = function(event) {
            statusEl.textContent = 'Connected - Receiving Data';
            statusEl.className = 'status connected';

            try {
                const data = JSON.parse(event.data);
                document.getElementById('jsonDisplay').innerHTML = syntaxHighlight(data);
            } catch (e) {
                console.error('Failed to parse data:', e);
            }
        };

        eventSource.onerror = function() {
            statusEl.textContent = 'Disconnected - Reconnecting...';
            statusEl.className = 'status disconnected';
        };
    </script>
    <script src="/js/navbar.js"></script>
    <script src="/js/i18n.js"></script>
</body>
</html>

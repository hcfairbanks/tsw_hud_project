<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSW HUD PROJECT</title>
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css">
    <script src="/js/theme-loader.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        h1 {
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 30px;
        }
        .subtitle {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 30px;
        }
        /* Nav styles now in theme.css */
        .card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        h2 {
            color: var(--accent-color);
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 5px;
        }
        .btn-primary {
            background: var(--accent-color);
            color: var(--bg-primary);
        }
        .btn-primary:hover {
            background: var(--accent-hover);
        }
        .btn-danger {
            background: var(--color-error);
            color: #fff;
        }
        .btn-danger:hover {
            background: #d63850;
        }
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        .btn-secondary:hover {
            background: var(--accent-hover);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        th {
            background: var(--bg-tertiary);
            color: var(--accent-color);
        }
        tr:hover {
            background: var(--bg-primary);
        }
        .actions {
            white-space: nowrap;
        }
        .actions button {
            padding: 5px 10px;
            font-size: 12px;
        }
        .empty-message {
            text-align: center;
            color: var(--text-muted);
            padding: 20px;
        }
        #editForm {
            display: none;
        }
        #editForm.active {
            display: block;
        }
    </style>
</head>
<body data-theme="dark">
    <h1 data-i18n="app.title">TSW HUD PROJECT</h1>

    <nav id="main-nav"></nav>

    <div class="card">
        <h2 data-i18n="home.welcome">Welcome</h2>
        <p data-i18n="home.welcomeMessage">Use the navigation above to manage routes and extract timetables from Train Sim World.</p>
    </div>

    <!-- Instructions Section -->
    <div class="card">
        <h2 data-i18n="home.gettingStarted">Getting Started Guide</h2>
        <p style="color: var(--text-muted); margin-bottom: 20px;" data-i18n="home.gettingStartedDesc">Learn how to use the TSW HUD PROJECT to track your train journeys.</p>

        <!-- Instruction 1: Extract Timetable from Images -->
        <div class="instruction-card">
            <div class="instruction-header" onclick="toggleInstruction('ocr')">
                <span class="instruction-number">1</span>
                <h3 data-i18n="home.instruction1Title">Extract Timetable from Images (OCR)</h3>
                <span class="instruction-toggle" id="ocr-toggle">+</span>
            </div>
            <div class="instruction-content" id="ocr-content">
                <p class="instruction-intro" data-i18n="home.instruction1Intro">Use OCR to automatically extract timetable data from Train Sim World screenshots.</p>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 1: <span data-i18n="instructions.captureScreenshots">Capture Screenshots in TSW</span></h4>
                    <p data-i18n="instructions.captureScreenshotsDesc">In Train Sim World, open your timetable and take screenshots of:</p>
                    <ul>
                        <li data-i18n="instructions.timetableHeader">The timetable header showing the service name and times</li>
                        <li data-i18n="instructions.timetableEntries">The detailed timetable entries showing stops, platforms, and times</li>
                    </ul>
                    <div class="instruction-images">
                        <div class="instruction-image">
                            <img src="/images/instructions/Screenshot 2026-01-22 233925.png" alt="Timetable Header" onclick="openLightbox(this.src, this.alt)" class="clickable-image">
                            <p class="image-caption">Example: Timetable header showing service "1C84 London Paddington to Penzance"</p>
                        </div>
                        <div class="instruction-image">
                            <img src="/images/instructions/Screenshot 2026-01-22 234019.png" alt="Timetable Entries" onclick="openLightbox(this.src, this.alt)" class="clickable-image">
                            <p class="image-caption">Example: Detailed timetable entries with actions, locations, platforms, and times</p>
                        </div>
                    </div>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 2: <span data-i18n="instructions.uploadImages">Upload Images</span></h4>
                    <ol>
                        <li data-i18n="instructions.uploadImagesStep1">Go to the Timetables page</li>
                        <li data-i18n="instructions.uploadImagesStep2">In the "Extract from Images" section, click or drag your screenshots into the upload area</li>
                        <li data-i18n="instructions.uploadImagesStep3">The system will automatically process the images using OCR</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 3: <span data-i18n="instructions.reviewData">Review and Edit Extracted Data</span></h4>
                    <ol>
                        <li data-i18n="instructions.reviewDataStep1">Review the extracted timetable entries in the table</li>
                        <li data-i18n="instructions.reviewDataStep2">Click on any cell to edit if the OCR made mistakes</li>
                        <li data-i18n="instructions.reviewDataStep3">Ensure the Action type is correctly selected for each row</li>
                        <li data-i18n="instructions.reviewDataStep4">Check that times are in HH:MM:SS format (e.g., 16:13:00)</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 4: <span data-i18n="instructions.completeTimetable">Complete the Timetable</span></h4>
                    <ol>
                        <li data-i18n="instructions.completeTimetableStep1">Enter or verify the Service Name</li>
                        <li data-i18n="instructions.completeTimetableStep2">Select a Route from the dropdown</li>
                        <li data-i18n="instructions.completeTimetableStep3">Select at least one Train for this service</li>
                        <li data-i18n="instructions.completeTimetableStep4">Click "Create Timetable" to save</li>
                    </ol>
                </div>

                <div class="instruction-warning">
                    <strong data-i18n="instructions.important">Important:</strong> <span data-i18n="instructions.importantFirstLocation">The first location and first platform are not included in the in-game timetable screenshots and will need to be added manually. This data can be added after creating the timetable without any issues.</span>
                </div>
            </div>
        </div>

        <!-- Instruction 2: Create Timetable Manually -->
        <div class="instruction-card">
            <div class="instruction-header" onclick="toggleInstruction('manual')">
                <span class="instruction-number">2</span>
                <h3 data-i18n="home.instruction2Title">Create Timetable Manually</h3>
                <span class="instruction-toggle" id="manual-toggle">+</span>
            </div>
            <div class="instruction-content" id="manual-content">
                <p class="instruction-intro" data-i18n="home.instruction2Intro">Build a timetable from scratch by entering each stop manually.</p>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 1: <span data-i18n="instructions.startNewTimetable">Start a New Timetable</span></h4>
                    <ol>
                        <li data-i18n="instructions.startNewTimetableStep1">Go to the Timetables page</li>
                        <li data-i18n="instructions.startNewTimetableStep2">Click the "+ Create New Timetable" button</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 2: <span data-i18n="instructions.enterBasicInfo">Enter Basic Information</span></h4>
                    <ol>
                        <li data-i18n="instructions.enterBasicInfoStep1">Enter the Service Name (e.g., "1C84 London Paddington to Penzance")</li>
                        <li data-i18n="instructions.enterBasicInfoStep2">Select the Route from the dropdown</li>
                        <li data-i18n="instructions.enterBasicInfoStep3">Select one or more Trains that can run this service</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 3: <span data-i18n="instructions.addEntries">Add Timetable Entries</span></h4>
                    <p data-i18n="instructions.addEntriesDesc">Click "+ Add Entry" to add stops. For each entry:</p>
                    <ul>
                        <li data-i18n="instructions.addEntriesAction">Action: Select the type (WAIT FOR SERVICE, STOP AT LOCATION, LOAD PASSENGERS, etc.)</li>
                        <li data-i18n="instructions.addEntriesLocation">Location: Enter the station name</li>
                        <li data-i18n="instructions.addEntriesPlatform">Platform: Enter the platform number if applicable</li>
                        <li data-i18n="instructions.addEntriesTime1">Time 1: Arrival time (HH:MM:SS format)</li>
                        <li data-i18n="instructions.addEntriesTime2">Time 2: Departure time (HH:MM:SS format)</li>
                    </ul>
                    <p data-i18n="instructions.addEntriesQuickAdd">Use the "Quick Add Common Entries" buttons to quickly add preset actions.</p>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 4: <span data-i18n="instructions.saveTimetable">Save the Timetable</span></h4>
                    <p data-i18n="instructions.saveTimetableDesc">Click "Create Timetable" when all entries are added.</p>
                </div>

                <div class="instruction-tip">
                    <strong data-i18n="instructions.tip">Tip:</strong> <span data-i18n="instructions.tipEditLater">You can always edit the timetable later by clicking on it in the timetables list.</span>
                </div>
            </div>
        </div>

        <!-- Instruction 3: Import from JSON -->
        <div class="instruction-card">
            <div class="instruction-header" onclick="toggleInstruction('import')">
                <span class="instruction-number">3</span>
                <h3 data-i18n="home.instruction3Title">Import Timetable from JSON</h3>
                <span class="instruction-toggle" id="import-toggle">+</span>
            </div>
            <div class="instruction-content" id="import-content">
                <p class="instruction-intro" data-i18n="home.instruction3Intro">Import previously exported timetables or share timetables with others.</p>

                <div class="instruction-step">
                    <h4 data-i18n="instructions.importingTimetable">Importing a Timetable</h4>
                    <ol>
                        <li data-i18n="instructions.importingStep1">Go to the Timetables page</li>
                        <li data-i18n="instructions.importingStep2">In the "Import Timetable" section, click or drag a JSON file into the upload area</li>
                        <li data-i18n="instructions.importingStep3">The system will validate and import the timetable automatically</li>
                        <li data-i18n="instructions.importingStep4">You'll be redirected to the timetable view on success</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4 data-i18n="instructions.exportingTimetable">Exporting a Timetable</h4>
                    <ol>
                        <li data-i18n="instructions.exportingStep1">Open any timetable from the list</li>
                        <li data-i18n="instructions.exportingStep2">Click the "Export JSON" button</li>
                        <li data-i18n="instructions.exportingStep3">Save the JSON file to share or backup</li>
                    </ol>
                </div>

                <div class="instruction-tip">
                    <strong data-i18n="instructions.tip">Tip:</strong> <span data-i18n="instructions.tipJsonExport">JSON exports include all timetable data including coordinates, making them perfect for backups or sharing complete routes.</span>
                </div>
            </div>
        </div>

        <!-- Instruction 4: Record Coordinates -->
        <div class="instruction-card">
            <div class="instruction-header" onclick="toggleInstruction('record')">
                <span class="instruction-number">4</span>
                <h3 data-i18n="home.instruction4Title">Record Timetable Coordinates</h3>
                <span class="instruction-toggle" id="record-toggle">+</span>
            </div>
            <div class="instruction-content" id="record-content">
                <p class="instruction-intro" data-i18n="home.instruction4Intro">Record GPS coordinates for your timetable by running the route in Train Sim World while connected to the HUD Project.</p>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 1: <span data-i18n="instructions.openRecordMap">Open the Record Map</span></h4>
                    <ol>
                        <li data-i18n="instructions.openRecordMapStep1">Go to the Record Map page</li>
                        <li data-i18n="instructions.openRecordMapStep2">Select your Route from the dropdown</li>
                        <li data-i18n="instructions.openRecordMapStep3">Select the Train Class</li>
                        <li data-i18n="instructions.openRecordMapStep4">Select the Train</li>
                        <li data-i18n="instructions.openRecordMapStep5">Select the Timetable you want to record</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 2: <span data-i18n="instructions.startRecording">Start Recording</span></h4>
                    <ol>
                        <li data-i18n="instructions.startRecordingStep1">Start Train Sim World and load your service</li>
                        <li data-i18n="instructions.startRecordingStep2">Click the "Start" button on the Record Map page</li>
                        <li data-i18n="instructions.startRecordingStep3">Begin driving your route - coordinates will be recorded automatically</li>
                        <li data-i18n="instructions.startRecordingStep4">The map will show your path in real-time</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 3: <span data-i18n="instructions.saveStationPositions">Save Station Positions</span></h4>
                    <p data-i18n="instructions.saveStationPositionsDesc">As you arrive at each station:</p>
                    <ol>
                        <li data-i18n="instructions.saveStationPositionsStep1">Select the station from the "Select Station" dropdown</li>
                        <li data-i18n="instructions.saveStationPositionsStep2">Click "Save Position" to record the coordinates</li>
                        <li data-i18n="instructions.saveStationPositionsStep3">The station will be marked with a green marker on the map</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 4: <span data-i18n="instructions.completeRecording">Complete Recording</span></h4>
                    <ol>
                        <li data-i18n="instructions.completeRecordingStep1">When finished, click "Save" to process and save all data</li>
                        <li data-i18n="instructions.completeRecordingStep2">The recording will be processed and saved to the database</li>
                        <li data-i18n="instructions.completeRecordingStep3">Click "Reset" to clear and start fresh if needed</li>
                    </ol>
                </div>

                <div class="instruction-tip">
                    <strong data-i18n="instructions.recordingModes">Recording Modes:</strong><br>
                    - <strong data-i18n="instructions.automatic">Automatic:</strong> <span data-i18n="instructions.automaticDesc">Recording auto-stops after 2 minutes of no movement</span><br>
                    - <strong data-i18n="instructions.manual">Manual:</strong> <span data-i18n="instructions.manualDesc">Recording continues until you click Save</span>
                </div>

                <div class="instruction-tip">
                    <strong data-i18n="instructions.tip">Tip:</strong> <span data-i18n="instructions.tipPause">Use the "Pause" button if you need to take a break during recording. Resume when ready to continue.</span>
                </div>
            </div>
        </div>

        <!-- Instruction 5: Automatically Record Coordinates -->
        <div class="instruction-card">
            <div class="instruction-header" onclick="toggleInstruction('auto-record')">
                <span class="instruction-number">5</span>
                <h3 data-i18n="home.instruction5Title">Automatically Record Timetable Coordinates</h3>
                <span class="instruction-toggle" id="auto-record-toggle">+</span>
            </div>
            <div class="instruction-content" id="auto-record-content">
                <p class="instruction-intro" data-i18n="home.instruction5Intro">Automatically record coordinates for your timetable entries while the AI drives the route for you. This explanation sounds more complicated than it is - a video tutorial will be added soon.</p>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 1: <span data-i18n="instructions.inGameSetup">In Game Setup</span></h4>
                    <ol>
                        <li data-i18n="instructions.inGameSetupStep1">Start Train Sim World</li>
                        <li data-i18n="instructions.inGameSetupStep2">Select your route</li>
                        <li data-i18n="instructions.inGameSetupStep3">Select your train</li>
                        <li data-i18n="instructions.inGameSetupStep4">Take a screenshot of the service name</li>
                        <li data-i18n="instructions.inGameSetupStep5">Start the timetable</li>
                        <li data-i18n="instructions.inGameSetupStep6">Do not touch any train controls</li>
                        <li data-i18n="instructions.inGameSetupStep7">Navigate to the schedule screen</li>
                        <li data-i18n="instructions.inGameSetupStep8">Take screenshots of the schedule (multiple if needed)</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 2: <span data-i18n="instructions.inTheApp">In the App</span></h4>
                    <ol>
                        <li data-i18n="instructions.inTheAppStep1">Start the server</li>
                        <li data-i18n="instructions.inTheAppStep2">Select or create your route</li>
                        <li data-i18n="instructions.inTheAppStep3">Select or create your train</li>
                        <li data-i18n="instructions.inTheAppStep4">Upload your screenshots to the Timetables page</li>
                    </ol>
                </div>

                <div class="instruction-warning">
                    <strong data-i18n="instructions.important">Important:</strong> <span data-i18n="instructions.importantScreenshotOrder">The order of screenshots matters! They need to be in chronological order. If your screenshots have timestamps and you followed the flow above, you will be fine.</span>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 3: <span data-i18n="instructions.completeTimetableData">Complete Timetable Data</span></h4>
                    <ol>
                        <li data-i18n="instructions.completeTimetableDataStep1">Go to Route Map to get the first location name and platform number</li>
                        <li data-i18n="instructions.completeTimetableDataStep2">Add the location name and platform number to the timetable</li>
                        <li data-i18n="instructions.completeTimetableDataStep3">Review and confirm the data - the "Service Name" often has OCR errors, but timetable data is usually accurate</li>
                        <li data-i18n="instructions.completeTimetableDataStep4">Click "Create Timetable"</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 4: <span data-i18n="instructions.startAutoRecording">Start Auto Recording</span></h4>
                    <ol>
                        <li data-i18n="instructions.startAutoRecordingStep1">Go to the Recording page</li>
                        <li data-i18n="instructions.startAutoRecordingStep2">Select your route, train, and timetable</li>
                        <li data-i18n="instructions.startAutoRecordingStep3">Click "Record"</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 5: <span data-i18n="instructions.enableAIDriver">Enable AI Driver (In Game)</span></h4>
                    <ol>
                        <li data-i18n="instructions.enableAIDriverStep1">Use God Mode to access the console commands</li>
                        <li data-i18n="instructions.enableAIDriverStep2">Enable the "Relinquish Service" command from the God Mode menu</li>
                        <li data-i18n="instructions.enableAIDriverStep3">Sit in the copilot's seat</li>
                        <li data-i18n="instructions.enableAIDriverStep4">Come back when automatic recording is complete</li>
                    </ol>
                    <div class="instruction-images">
                        <div class="instruction-image">
                            <img src="/images/instructions/Screenshot 2026-01-24 130437.png" alt="God Mode - Relinquish Service" onclick="openLightbox(this.src, this.alt)" class="clickable-image">
                            <p class="image-caption">God Mode menu showing the "Relinquish Service" option</p>
                        </div>
                    </div>
                </div>

                <div class="instruction-tip">
                    <strong data-i18n="instructions.stopDetection">How Stop Detection Works:</strong><br>
                    - <span data-i18n="instructions.stopDetectionDesc1">Each stop (including the first) must be recorded stopped for a minimum of 30 seconds to be identified as a stop</span><br>
                    - <span data-i18n="instructions.stopDetectionDesc2">If the train doesn't move for around 5 minutes (usually at the last stop), the server will automatically stop recording, identify all stops based on timing, and save everything to the database</span>
                </div>

                <div class="instruction-tip">
                    <strong data-i18n="instructions.benefit">Benefit:</strong> <span data-i18n="instructions.benefitDesc">This method lets you enjoy all the data that comes from a full route recording without having to sit through the entire journey!</span>
                </div>
            </div>
        </div>

        <!-- Instruction 6: Tracking Map -->
        <div class="instruction-card">
            <div class="instruction-header" onclick="toggleInstruction('tracking')">
                <span class="instruction-number">6</span>
                <h3 data-i18n="home.instruction6Title">Using the Tracking Map</h3>
                <span class="instruction-toggle" id="tracking-toggle">+</span>
            </div>
            <div class="instruction-content" id="tracking-content">
                <p class="instruction-intro" data-i18n="home.instruction6Intro">View your live train position on the map while playing Train Sim World.</p>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 1: <span data-i18n="instructions.loadTimetable">Load a Timetable</span></h4>
                    <ol>
                        <li data-i18n="instructions.loadTimetableStep1">Go to the Tracking Map page</li>
                        <li data-i18n="instructions.loadTimetableStep2">In the "Load Timetable" section, select your Route</li>
                        <li data-i18n="instructions.loadTimetableStep3">Select the Train Class and Train</li>
                        <li data-i18n="instructions.loadTimetableStep4">Select a Timetable (only timetables with recorded coordinates will appear)</li>
                        <li data-i18n="instructions.loadTimetableStep5">Click "Load Timetable"</li>
                    </ol>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 2: <span data-i18n="instructions.viewLiveTracking">View Live Tracking</span></h4>
                    <p data-i18n="instructions.viewLiveTrackingDesc">Once connected to Train Sim World:</p>
                    <ul>
                        <li data-i18n="instructions.viewLiveTrackingOrange">Your train position appears as an orange marker</li>
                        <li data-i18n="instructions.viewLiveTrackingBlue">The route path is shown as a blue line</li>
                        <li data-i18n="instructions.viewLiveTrackingGreen">Station stops are marked with green circles</li>
                        <li data-i18n="instructions.viewLiveTrackingInfo">The info panel shows your current speed and direction</li>
                    </ul>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 3: <span data-i18n="instructions.timetableInfo">Timetable Information</span></h4>
                    <p data-i18n="instructions.timetableInfoDesc">The timetable display shows:</p>
                    <ul>
                        <li data-i18n="instructions.timetableInfoGameTime">Game Time: Current in-game time</li>
                        <li data-i18n="instructions.timetableInfoNextStop">Next Stop Time: Scheduled time for the next station</li>
                        <li data-i18n="instructions.timetableInfoDistance">Distance: Distance remaining to the next stop</li>
                    </ul>
                </div>

                <div class="instruction-step">
                    <h4><span data-i18n="instructions.step">Step</span> 4: <span data-i18n="instructions.followMode">Follow Mode</span></h4>
                    <ol>
                        <li data-i18n="instructions.followModeStep1">Click "Follow Train" to keep the map centered on your position</li>
                        <li data-i18n="instructions.followModeStep2">Click "Stop Following" to browse the map freely</li>
                    </ol>
                </div>

                <div class="instruction-tip">
                    <strong data-i18n="instructions.tip">Tip:</strong> <span data-i18n="instructions.tipOpenHUD">Click "Open HUD" to open a dedicated heads-up display window that you can position alongside your game.</span>
                </div>

                <div class="instruction-tip">
                    <strong data-i18n="instructions.mapLegend">Map Legend:</strong><br>
                    - <span style="color: #0066ff;" data-i18n="instructions.blueLine">Blue line</span> = <span data-i18n="instructions.routePath">Route path</span><br>
                    - <span style="color: #00cc66;" data-i18n="instructions.greenCircles">Green circles</span> = <span data-i18n="instructions.timetableStations">Timetable stations</span><br>
                    - <span style="color: #ffa500;" data-i18n="instructions.orangeMarker">Orange marker</span> = <span data-i18n="instructions.liveTrainPosition">Your live train position</span>
                </div>
            </div>
        </div>
    </div>

    <style>
        .instruction-card {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .instruction-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--bg-tertiary);
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }
        .instruction-header:hover {
            background: var(--bg-primary);
        }
        .instruction-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--accent-color);
            color: var(--bg-primary);
            border-radius: 50%;
            font-weight: bold;
            font-size: 14px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        .instruction-header h3 {
            margin: 0;
            font-size: 16px;
            color: var(--text-primary);
            flex-grow: 1;
            border-bottom: none;
            padding-bottom: 0;
        }
        .instruction-toggle {
            font-size: 20px;
            font-weight: bold;
            color: var(--text-muted);
            width: 24px;
            text-align: center;
        }
        .instruction-content {
            display: none;
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }
        .instruction-content.active {
            display: block;
        }
        .instruction-intro {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 14px;
        }
        .instruction-step {
            margin-bottom: 20px;
        }
        .instruction-step h4 {
            color: var(--accent-color);
            margin: 0 0 10px 0;
            font-size: 14px;
        }
        .instruction-step p, .instruction-step li {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
        }
        .instruction-step ol, .instruction-step ul {
            margin: 10px 0;
            padding-left: 25px;
        }
        .instruction-step li {
            margin-bottom: 5px;
        }
        .instruction-images {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        .instruction-image {
            flex: 1;
            min-width: 280px;
            max-width: 500px;
        }
        .instruction-image img {
            width: 100%;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        .image-caption {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
            text-align: center;
        }
        .instruction-tip {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-color);
            padding: 12px 15px;
            margin-top: 15px;
            border-radius: 0 4px 4px 0;
            font-size: 13px;
            color: var(--text-secondary);
        }
        .instruction-tip strong {
            color: var(--accent-color);
        }
        .instruction-warning {
            background: var(--color-error-bg);
            border-left: 3px solid var(--color-error);
            padding: 12px 15px;
            margin-top: 15px;
            border-radius: 0 4px 4px 0;
            font-size: 13px;
            color: var(--text-secondary);
        }
        .instruction-warning strong {
            color: var(--color-error);
        }
        .clickable-image {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .clickable-image:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .lightbox.active {
            display: flex;
        }
        .lightbox-content {
            max-width: 90%;
            max-height: 85%;
            object-fit: contain;
            border-radius: 4px;
        }
        .lightbox-caption {
            color: white;
            margin-top: 15px;
            font-size: 14px;
            text-align: center;
        }
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .lightbox-close:hover {
            color: var(--color-error);
        }
    </style>

    <!-- Lightbox Modal -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <span class="lightbox-close">&times;</span>
        <img class="lightbox-content" id="lightbox-img" src="" alt="">
        <p class="lightbox-caption" id="lightbox-caption"></p>
    </div>

    <script>
        // Apply theme on page load
        function applyTheme(theme) {
            document.body.setAttribute('data-theme', theme);
        }

        // Apply color scheme for accessibility
        function applyColorScheme(scheme) {
            if (scheme && scheme !== 'default') {
                document.body.setAttribute('data-color-scheme', scheme);
            } else {
                document.body.removeAttribute('data-color-scheme');
            }
        }

        // Load theme from localStorage first for instant apply
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            applyTheme(savedTheme);
        }

        // Load color scheme from localStorage
        const savedColorScheme = localStorage.getItem('colorScheme');
        if (savedColorScheme) {
            applyColorScheme(savedColorScheme);
        }

        // Then fetch from server to ensure sync
        fetch('/api/config')
            .then(res => res.json())
            .then(config => {
                const theme = config.theme || 'dark';
                applyTheme(theme);
                localStorage.setItem('theme', theme);

                const colorScheme = config.colorScheme || 'default';
                applyColorScheme(colorScheme);
                localStorage.setItem('colorScheme', colorScheme);
            })
            .catch(err => console.error('Failed to load config:', err));

        // Toggle instruction sections
        function toggleInstruction(id) {
            const content = document.getElementById(id + '-content');
            const toggle = document.getElementById(id + '-toggle');

            if (content.classList.contains('active')) {
                content.classList.remove('active');
                toggle.textContent = '+';
            } else {
                content.classList.add('active');
                toggle.textContent = '-';
            }
        }

        // Lightbox functions
        function openLightbox(src, alt) {
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightbox-img');
            const caption = document.getElementById('lightbox-caption');

            img.src = src;
            img.alt = alt;
            caption.textContent = alt;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close lightbox on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLightbox();
            }
        });
    </script>
    <script src="/js/navbar.js"></script>
    <script src="/js/i18n.js"></script>
</body>
</html>
